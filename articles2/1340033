Path: news.gmane.org!not-for-mail
From: Holger Kiehl <Holger.Kiehl@dwd.de>
Newsgroups: gmane.linux.kernel,gmane.linux.raid
Subject: What happened to TRIM support for raid linear/0/1/10?
Date: Wed, 8 Aug 2012 13:10:51 +0000 (GMT)
Lines: 285
Approved: news@gmane.org
Message-ID: <alpine.LRH.2.02.1208081308380.30954@praktifix.dwd.de>
NNTP-Posting-Host: plane.gmane.org
Mime-Version: 1.0
Content-Type: MULTIPART/MIXED; BOUNDARY="8323328-1418712126-1344431451=:30954"
X-Trace: dough.gmane.org 1344432063 30084 80.91.229.3 (8 Aug 2012 13:21:03 GMT)
X-Complaints-To: usenet@dough.gmane.org
NNTP-Posting-Date: Wed, 8 Aug 2012 13:21:03 +0000 (UTC)
Cc: "linux-raid@vger.kernel.org" <linux-raid@vger.kernel.org>,
	"linux-kernel@vger.kernel.org" <linux-kernel@vger.kernel.org>
To: Shaohua Li <shli@kernel.org>, "neilb@suse.de" <neilb@suse.de>
Original-X-From: linux-kernel-owner@vger.kernel.org Wed Aug 08 15:21:03 2012
Return-path: <linux-kernel-owner@vger.kernel.org>
Envelope-to: glk-linux-kernel-3@plane.gmane.org
Original-Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <linux-kernel-owner@vger.kernel.org>)
	id 1Sz6C5-0003V2-UH
	for glk-linux-kernel-3@plane.gmane.org; Wed, 08 Aug 2012 15:21:02 +0200
Original-Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1758366Ab2HHNUy (ORCPT <rfc822;glk-linux-kernel-3@m.gmane.org>);
	Wed, 8 Aug 2012 09:20:54 -0400
Original-Received: from ofcsgdbm.dwd.de ([141.38.3.245]:56754 "EHLO ofcsgdbm.dwd.de"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1758285Ab2HHNUw (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Wed, 8 Aug 2012 09:20:52 -0400
X-Greylist: delayed 598 seconds by postgrey-1.27 at vger.kernel.org; Wed, 08 Aug 2012 09:20:51 EDT
Original-Received: from localhost (localhost [127.0.0.1])
	by ofcsgdn3.dwd.de (Postfix) with ESMTP id 2C33C54243
	for <linux-kernel@vger.kernel.org>; Wed,  8 Aug 2012 13:10:52 +0000 (UTC)
X-Virus-Scanned: by amavisd-new at csg.dwd.de
Original-Received: from ofcsgdn3.dwd.de ([127.0.0.1])
	by localhost (ofcsgdn3.csg.lan [127.0.0.1]) (amavisd-new, port 10024)
	with LMTP id OAZSQcNlevtI for <linux-kernel@vger.kernel.org>;
	Wed,  8 Aug 2012 13:10:52 +0000 (UTC)
Original-Received: from mailhub.dwd.de (oflsv148.dwd.de [141.38.42.197])
	by ofcsgdn3.dwd.de (Postfix) with ESMTP id F295754212;
	Wed,  8 Aug 2012 13:10:51 +0000 (UTC)
Original-Received: from praktifix.dwd.de (praktifix.dwd.de [141.38.42.142])
	by mailhub.dwd.de (Postfix) with ESMTP id EA9F437E0;
	Wed,  8 Aug 2012 13:10:51 +0000 (UCT)
X-X-Sender: kiehl@praktifix.dwd.de
User-Agent: Alpine 2.02 (LRH 1266 2009-07-14)
Original-Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
Xref: news.gmane.org gmane.linux.kernel:1340033 gmane.linux.raid:39639
Archived-At: <http://permalink.gmane.org/gmane.linux.kernel/1340033>

  This message is in MIME format.  The first part should be readable text,
  while the remaining parts are likely unreadable without MIME-aware tools.

--8323328-1418712126-1344431451=:30954
Content-Type: TEXT/PLAIN; format=flowed; charset=US-ASCII

Hello,

I have been using the patches posted by Shaohua Li on 16th March 2012:

    http://lkml.indiana.edu/hypermail/linux/kernel/1203.2/00048.html

for several month on a very busy file server (serving 9 million files
with 5.3 TiB daily) without any problems.

Is there any chance that these patches will go into the official kernel?
Or what is the reason that these patches are no applied?

I have attached the patch set in one big patch for 3.5. Please do not
use it since I am not sure if it is correct. Shaohua could you please
take a look if it is correct and maybe post a new one?

Personally, I would think that TRIM support MD would be a very good thing.

Regards,
Holger
--8323328-1418712126-1344431451=:30954
Content-Type: TEXT/PLAIN; charset=US-ASCII; name=md-trim-3.5.patch
Content-Transfer-Encoding: BASE64
Content-ID: <alpine.LRH.2.02.1208081310510.30954@praktifix.dwd.de>
Content-Description: 
Content-Disposition: attachment; filename=md-trim-3.5.patch

ZGlmZiAtdSAtLXJlY3Vyc2l2ZSAtLW5ldy1maWxlIGxpbnV4LTMuNS5vcmln
L2RyaXZlcnMvbWQvbGluZWFyLmMgbGludXgtMy41L2RyaXZlcnMvbWQvbGlu
ZWFyLmMNCi0tLSBsaW51eC0zLjUub3JpZy9kcml2ZXJzL21kL2xpbmVhci5j
CTIwMTItMDctMjEgMjA6NTg6MjkuMDAwMDAwMDAwICswMDAwDQorKysgbGlu
dXgtMy41L2RyaXZlcnMvbWQvbGluZWFyLmMJMjAxMi0wNy0yNyAwNjo1Mzoz
OS41MDcxMjE0MzQgKzAwMDANCkBAIC0xMzgsNiArMTM4LDcgQEANCiAJc3Ry
dWN0IGxpbmVhcl9jb25mICpjb25mOw0KIAlzdHJ1Y3QgbWRfcmRldiAqcmRl
djsNCiAJaW50IGksIGNudDsNCisJYm9vbCBkaXNjYXJkX3N1cHBvcnRlZCA9
IGZhbHNlOw0KIA0KIAljb25mID0ga3phbGxvYyAoc2l6ZW9mICgqY29uZikg
KyByYWlkX2Rpc2tzKnNpemVvZihzdHJ1Y3QgZGV2X2luZm8pLA0KIAkJCUdG
UF9LRVJORUwpOw0KQEAgLTE3MSw2ICsxNzIsOCBAQA0KIAkJY29uZi0+YXJy
YXlfc2VjdG9ycyArPSByZGV2LT5zZWN0b3JzOw0KIAkJY250Kys7DQogDQor
CQlpZiAoYmxrX3F1ZXVlX2Rpc2NhcmQoYmRldl9nZXRfcXVldWUocmRldi0+
YmRldikpKQ0KKwkJCWRpc2NhcmRfc3VwcG9ydGVkID0gdHJ1ZTsNCiAJfQ0K
IAlpZiAoY250ICE9IHJhaWRfZGlza3MpIHsNCiAJCXByaW50ayhLRVJOX0VS
UiAibWQvbGluZWFyOiVzOiBub3QgZW5vdWdoIGRyaXZlcyBwcmVzZW50LiBB
Ym9ydGluZyFcbiIsDQpAQCAtMTc4LDYgKzE4MSwxMSBAQA0KIAkJZ290byBv
dXQ7DQogCX0NCiANCisJaWYgKCFkaXNjYXJkX3N1cHBvcnRlZCkNCisJCXF1
ZXVlX2ZsYWdfY2xlYXJfdW5sb2NrZWQoUVVFVUVfRkxBR19ESVNDQVJELCBt
ZGRldi0+cXVldWUpOw0KKwllbHNlDQorCQlxdWV1ZV9mbGFnX3NldF91bmxv
Y2tlZChRVUVVRV9GTEFHX0RJU0NBUkQsIG1kZGV2LT5xdWV1ZSk7DQorDQog
CS8qDQogCSAqIEhlcmUgd2UgY2FsY3VsYXRlIHRoZSBkZXZpY2Ugb2Zmc2V0
cy4NCiAJICovDQpAQCAtMzI2LDYgKzMzNCwxNCBAQA0KIAliaW8tPmJpX3Nl
Y3RvciA9IGJpby0+Ymlfc2VjdG9yIC0gc3RhcnRfc2VjdG9yDQogCQkrIHRt
cF9kZXYtPnJkZXYtPmRhdGFfb2Zmc2V0Ow0KIAlyY3VfcmVhZF91bmxvY2so
KTsNCisNCisJaWYgKHVubGlrZWx5KChiaW8tPmJpX3J3ICYgUkVRX0RJU0NB
UkQpICYmDQorCQkhYmxrX3F1ZXVlX2Rpc2NhcmQoYmRldl9nZXRfcXVldWUo
YmlvLT5iaV9iZGV2KSkpKSB7DQorCQkvKiBKdXN0IGlnbm9yZSBpdCAqLw0K
KwkJYmlvX2VuZGlvKGJpbywgMCk7DQorCQlyZXR1cm47DQorCX0NCisNCiAJ
Z2VuZXJpY19tYWtlX3JlcXVlc3QoYmlvKTsNCiB9DQogDQpkaWZmIC11IC0t
cmVjdXJzaXZlIC0tbmV3LWZpbGUgbGludXgtMy41Lm9yaWcvZHJpdmVycy9t
ZC9yYWlkMC5jIGxpbnV4LTMuNS9kcml2ZXJzL21kL3JhaWQwLmMNCi0tLSBs
aW51eC0zLjUub3JpZy9kcml2ZXJzL21kL3JhaWQwLmMJMjAxMi0wNy0yMSAy
MDo1ODoyOS4wMDAwMDAwMDAgKzAwMDANCisrKyBsaW51eC0zLjUvZHJpdmVy
cy9tZC9yYWlkMC5jCTIwMTItMDctMjcgMDY6NTM6MzkuNTA3MTIxNDM0ICsw
MDAwDQpAQCAtODgsNiArODgsNyBAQA0KIAljaGFyIGJbQkRFVk5BTUVfU0la
RV07DQogCWNoYXIgYjJbQkRFVk5BTUVfU0laRV07DQogCXN0cnVjdCByMGNv
bmYgKmNvbmYgPSBremFsbG9jKHNpemVvZigqY29uZiksIEdGUF9LRVJORUwp
Ow0KKwlib29sIGRpc2NhcmRfc3VwcG9ydGVkID0gZmFsc2U7DQogDQogCWlm
ICghY29uZikNCiAJCXJldHVybiAtRU5PTUVNOw0KQEAgLTE5NSw2ICsxOTYs
OSBAQA0KIAkJaWYgKCFzbWFsbGVzdCB8fCAocmRldjEtPnNlY3RvcnMgPCBz
bWFsbGVzdC0+c2VjdG9ycykpDQogCQkJc21hbGxlc3QgPSByZGV2MTsNCiAJ
CWNudCsrOw0KKw0KKwkJaWYgKGJsa19xdWV1ZV9kaXNjYXJkKGJkZXZfZ2V0
X3F1ZXVlKHJkZXYxLT5iZGV2KSkpDQorCQkJZGlzY2FyZF9zdXBwb3J0ZWQg
PSB0cnVlOw0KIAl9DQogCWlmIChjbnQgIT0gbWRkZXYtPnJhaWRfZGlza3Mp
IHsNCiAJCXByaW50ayhLRVJOX0VSUiAibWQvcmFpZDA6JXM6IHRvbyBmZXcg
ZGlza3MgKCVkIG9mICVkKSAtICINCkBAIC0yNzIsNiArMjc2LDExIEBADQog
CWJsa19xdWV1ZV9pb19vcHQobWRkZXYtPnF1ZXVlLA0KIAkJCSAobWRkZXYt
PmNodW5rX3NlY3RvcnMgPDwgOSkgKiBtZGRldi0+cmFpZF9kaXNrcyk7DQog
DQorCWlmICghZGlzY2FyZF9zdXBwb3J0ZWQpDQorCQlxdWV1ZV9mbGFnX2Ns
ZWFyX3VubG9ja2VkKFFVRVVFX0ZMQUdfRElTQ0FSRCwgbWRkZXYtPnF1ZXVl
KTsNCisJZWxzZQ0KKwkJcXVldWVfZmxhZ19zZXRfdW5sb2NrZWQoUVVFVUVf
RkxBR19ESVNDQVJELCBtZGRldi0+cXVldWUpOw0KKw0KIAlwcl9kZWJ1Zygi
bWQvcmFpZDA6JXM6IGRvbmUuXG4iLCBtZG5hbWUobWRkZXYpKTsNCiAJKnBy
aXZhdGVfY29uZiA9IGNvbmY7DQogDQpAQCAtNDIyLDYgKzQzMSw3IEBADQog
CWlmIChtZF9jaGVja19ub19iaXRtYXAobWRkZXYpKQ0KIAkJcmV0dXJuIC1F
SU5WQUw7DQogCWJsa19xdWV1ZV9tYXhfaHdfc2VjdG9ycyhtZGRldi0+cXVl
dWUsIG1kZGV2LT5jaHVua19zZWN0b3JzKTsNCisJYmxrX3F1ZXVlX21heF9k
aXNjYXJkX3NlY3RvcnMobWRkZXYtPnF1ZXVlLCBtZGRldi0+Y2h1bmtfc2Vj
dG9ycyk7DQogDQogCS8qIGlmIHByaXZhdGUgaXMgbm90IG51bGwsIHdlIGFy
ZSBoZXJlIGFmdGVyIHRha2VvdmVyICovDQogCWlmIChtZGRldi0+cHJpdmF0
ZSA9PSBOVUxMKSB7DQpAQCAtNTA5LDcgKzUxOSw3IEBADQogCQlzZWN0b3Jf
dCBzZWN0b3IgPSBiaW8tPmJpX3NlY3RvcjsNCiAJCXN0cnVjdCBiaW9fcGFp
ciAqYnA7DQogCQkvKiBTYW5pdHkgY2hlY2sgLS0gcXVldWUgZnVuY3Rpb25z
IHNob3VsZCBwcmV2ZW50IHRoaXMgaGFwcGVuaW5nICovDQotCQlpZiAoYmlv
LT5iaV92Y250ICE9IDEgfHwNCisJCWlmICgoYmlvLT5iaV92Y250ICE9IDEg
JiYgYmlvLT5iaV92Y250ICE9IDApIHx8DQogCQkgICAgYmlvLT5iaV9pZHgg
IT0gMCkNCiAJCQlnb3RvIGJhZF9tYXA7DQogCQkvKiBUaGlzIGlzIGEgb25l
IHBhZ2UgYmlvIHRoYXQgdXBwZXIgbGF5ZXJzDQpAQCAtNTM1LDYgKzU0NSwx
MyBAQA0KIAliaW8tPmJpX3NlY3RvciA9IHNlY3Rvcl9vZmZzZXQgKyB6b25l
LT5kZXZfc3RhcnQgKw0KIAkJdG1wX2Rldi0+ZGF0YV9vZmZzZXQ7DQogDQor
CWlmICh1bmxpa2VseSgoYmlvLT5iaV9ydyAmIFJFUV9ESVNDQVJEKSAmJg0K
KwkJIWJsa19xdWV1ZV9kaXNjYXJkKGJkZXZfZ2V0X3F1ZXVlKGJpby0+Ymlf
YmRldikpKSkgew0KKwkJLyogSnVzdCBpZ25vcmUgaXQgKi8NCisJCWJpb19l
bmRpbyhiaW8sIDApOw0KKwkJcmV0dXJuOw0KKwl9DQorDQogCWdlbmVyaWNf
bWFrZV9yZXF1ZXN0KGJpbyk7DQogCXJldHVybjsNCiANCmRpZmYgLXUgLS1y
ZWN1cnNpdmUgLS1uZXctZmlsZSBsaW51eC0zLjUub3JpZy9kcml2ZXJzL21k
L3JhaWQxMC5jIGxpbnV4LTMuNS9kcml2ZXJzL21kL3JhaWQxMC5jDQotLS0g
bGludXgtMy41Lm9yaWcvZHJpdmVycy9tZC9yYWlkMTAuYwkyMDEyLTA3LTIx
IDIwOjU4OjI5LjAwMDAwMDAwMCArMDAwMA0KKysrIGxpbnV4LTMuNS9kcml2
ZXJzL21kL3JhaWQxMC5jCTIwMTItMDctMjcgMDY6NTM6MzkuNTA3MTIxNDM1
ICswMDAwDQpAQCAtODg3LDcgKzg4NywxMiBAQA0KIAkJd2hpbGUgKGJpbykg
eyAvKiBzdWJtaXQgcGVuZGluZyB3cml0ZXMgKi8NCiAJCQlzdHJ1Y3QgYmlv
ICpuZXh0ID0gYmlvLT5iaV9uZXh0Ow0KIAkJCWJpby0+YmlfbmV4dCA9IE5V
TEw7DQotCQkJZ2VuZXJpY19tYWtlX3JlcXVlc3QoYmlvKTsNCisJCQlpZiAo
dW5saWtlbHkoKGJpby0+YmlfcncgJiBSRVFfRElTQ0FSRCkgJiYNCisJCQkg
ICAgIWJsa19xdWV1ZV9kaXNjYXJkKGJkZXZfZ2V0X3F1ZXVlKGJpby0+Ymlf
YmRldikpKSkNCisJCQkJLyogSnVzdCBpZ25vcmUgaXQgKi8NCisJCQkJYmlv
X2VuZGlvKGJpbywgMCk7DQorCQkJZWxzZQ0KKwkJCQlnZW5lcmljX21ha2Vf
cmVxdWVzdChiaW8pOw0KIAkJCWJpbyA9IG5leHQ7DQogCQl9DQogCX0gZWxz
ZQ0KQEAgLTEwMTcsNyArMTAyMiw3IEBADQogfQ0KIA0KIHN0YXRpYyBzZWN0
b3JfdCBjaG9vc2VfZGF0YV9vZmZzZXQoc3RydWN0IHIxMGJpbyAqcjEwX2Jp
bywNCi0JCQkJICAgc3RydWN0IG1kX3JkZXYgKnJkZXYpDQorCQkJCXN0cnVj
dCBtZF9yZGV2ICpyZGV2KQ0KIHsNCiAJaWYgKCF0ZXN0X2JpdChNRF9SRUNP
VkVSWV9SRVNIQVBFLCAmcmRldi0+bWRkZXYtPnJlY292ZXJ5KSB8fA0KIAkg
ICAgdGVzdF9iaXQoUjEwQklPX1ByZXZpb3VzLCAmcjEwX2Jpby0+c3RhdGUp
KQ0KQEAgLTEwMzcsNiArMTA0Miw3IEBADQogCWNvbnN0IGludCBydyA9IGJp
b19kYXRhX2RpcihiaW8pOw0KIAljb25zdCB1bnNpZ25lZCBsb25nIGRvX3N5
bmMgPSAoYmlvLT5iaV9ydyAmIFJFUV9TWU5DKTsNCiAJY29uc3QgdW5zaWdu
ZWQgbG9uZyBkb19mdWEgPSAoYmlvLT5iaV9ydyAmIFJFUV9GVUEpOw0KKwlj
b25zdCB1bnNpZ25lZCBsb25nIGRvX2Rpc2NhcmQgPSAoYmlvLT5iaV9ydyAm
IChSRVFfRElTQ0FSRCB8IFJFUV9TRUNVUkUpKTsNCiAJdW5zaWduZWQgbG9u
ZyBmbGFnczsNCiAJc3RydWN0IG1kX3JkZXYgKmJsb2NrZWRfcmRldjsNCiAJ
aW50IHNlY3RvcnNfaGFuZGxlZDsNCkBAIC0xMDU3LDcgKzEwNjMsNyBAQA0K
IAkJCSB8fCBjb25mLT5wcmV2Lm5lYXJfY29waWVzIDwgY29uZi0+cHJldi5y
YWlkX2Rpc2tzKSkpIHsNCiAJCXN0cnVjdCBiaW9fcGFpciAqYnA7DQogCQkv
KiBTYW5pdHkgY2hlY2sgLS0gcXVldWUgZnVuY3Rpb25zIHNob3VsZCBwcmV2
ZW50IHRoaXMgaGFwcGVuaW5nICovDQotCQlpZiAoYmlvLT5iaV92Y250ICE9
IDEgfHwNCisJCWlmICgoYmlvLT5iaV92Y250ICE9IDEgJiYgYmlvLT5iaV92
Y250ICE9MCkgfHwNCiAJCSAgICBiaW8tPmJpX2lkeCAhPSAwKQ0KIAkJCWdv
dG8gYmFkX21hcDsNCiAJCS8qIFRoaXMgaXMgYSBvbmUgcGFnZSBiaW8gdGhh
dCB1cHBlciBsYXllcnMNCkBAIC0xMzg2LDcgKzEzOTIsNyBAQA0KIAkJCQkJ
CSAgICAgIGNvbmYtPm1pcnJvcnNbZF0ucmRldikpOw0KIAkJbWJpby0+Ymlf
YmRldiA9IGNvbmYtPm1pcnJvcnNbZF0ucmRldi0+YmRldjsNCiAJCW1iaW8t
PmJpX2VuZF9pbwk9IHJhaWQxMF9lbmRfd3JpdGVfcmVxdWVzdDsNCi0JCW1i
aW8tPmJpX3J3ID0gV1JJVEUgfCBkb19zeW5jIHwgZG9fZnVhOw0KKwkJbWJp
by0+YmlfcncgPSBXUklURSB8IGRvX3N5bmMgfCBkb19mdWEgfCBkb19kaXNj
YXJkOw0KIAkJbWJpby0+YmlfcHJpdmF0ZSA9IHIxMF9iaW87DQogDQogCQlh
dG9taWNfaW5jKCZyMTBfYmlvLT5yZW1haW5pbmcpOw0KQEAgLTE0MTUsNyAr
MTQyMSw3IEBADQogCQkJCQkgICBjb25mLT5taXJyb3JzW2RdLnJlcGxhY2Vt
ZW50KSk7DQogCQltYmlvLT5iaV9iZGV2ID0gY29uZi0+bWlycm9yc1tkXS5y
ZXBsYWNlbWVudC0+YmRldjsNCiAJCW1iaW8tPmJpX2VuZF9pbwk9IHJhaWQx
MF9lbmRfd3JpdGVfcmVxdWVzdDsNCi0JCW1iaW8tPmJpX3J3ID0gV1JJVEUg
fCBkb19zeW5jIHwgZG9fZnVhOw0KKwkJbWJpby0+YmlfcncgPSBXUklURSB8
IGRvX3N5bmMgfCBkb19mdWEgfCBkb19kaXNjYXJkOw0KIAkJbWJpby0+Ymlf
cHJpdmF0ZSA9IHIxMF9iaW87DQogDQogCQlhdG9taWNfaW5jKCZyMTBfYmlv
LT5yZW1haW5pbmcpOw0KQEAgLTE2OTksNiArMTcwNSw5IEBADQogCQljbGVh
cl9iaXQoVW5tZXJnZWQsICZyZGV2LT5mbGFncyk7DQogCX0NCiAJbWRfaW50
ZWdyaXR5X2FkZF9yZGV2KHJkZXYsIG1kZGV2KTsNCisJaWYgKGJsa19xdWV1
ZV9kaXNjYXJkKGJkZXZfZ2V0X3F1ZXVlKHJkZXYtPmJkZXYpKSkNCisJCXF1
ZXVlX2ZsYWdfc2V0X3VubG9ja2VkKFFVRVVFX0ZMQUdfRElTQ0FSRCwgbWRk
ZXYtPnF1ZXVlKTsNCisNCiAJcHJpbnRfY29uZihjb25mKTsNCiAJcmV0dXJu
IGVycjsNCiB9DQpAQCAtMzQ1Nyw2ICszNDY2LDcgQEANCiAJc2VjdG9yX3Qg
c2l6ZTsNCiAJc2VjdG9yX3QgbWluX29mZnNldF9kaWZmID0gMDsNCiAJaW50
IGZpcnN0ID0gMTsNCisJYm9vbCBkaXNjYXJkX3N1cHBvcnRlZCA9IGZhbHNl
Ow0KIA0KIAlpZiAobWRkZXYtPnByaXZhdGUgPT0gTlVMTCkgew0KIAkJY29u
ZiA9IHNldHVwX2NvbmYobWRkZXYpOw0KQEAgLTM0NzEsNiArMzQ4MSw3IEBA
DQogCW1kZGV2LT50aHJlYWQgPSBjb25mLT50aHJlYWQ7DQogCWNvbmYtPnRo
cmVhZCA9IE5VTEw7DQogDQorCWJsa19xdWV1ZV9tYXhfZGlzY2FyZF9zZWN0
b3JzKG1kZGV2LT5xdWV1ZSwgbWRkZXYtPmNodW5rX3NlY3RvcnMpOw0KIAlj
aHVua19zaXplID0gbWRkZXYtPmNodW5rX3NlY3RvcnMgPDwgOTsNCiAJYmxr
X3F1ZXVlX2lvX21pbihtZGRldi0+cXVldWUsIGNodW5rX3NpemUpOw0KIAlp
ZiAoY29uZi0+Z2VvLnJhaWRfZGlza3MgJSBjb25mLT5nZW8ubmVhcl9jb3Bp
ZXMpDQpAQCAtMzUxNSw4ICszNTI2LDE2IEBADQogCQkJCSAgcmRldi0+ZGF0
YV9vZmZzZXQgPDwgOSk7DQogDQogCQlkaXNrLT5oZWFkX3Bvc2l0aW9uID0g
MDsNCisNCisJCWlmIChibGtfcXVldWVfZGlzY2FyZChiZGV2X2dldF9xdWV1
ZShyZGV2LT5iZGV2KSkpDQorCQkJZGlzY2FyZF9zdXBwb3J0ZWQgPSB0cnVl
Ow0KIAl9DQogDQorCWlmIChkaXNjYXJkX3N1cHBvcnRlZCkNCisJCXF1ZXVl
X2ZsYWdfc2V0X3VubG9ja2VkKFFVRVVFX0ZMQUdfRElTQ0FSRCwgbWRkZXYt
PnF1ZXVlKTsNCisJZWxzZQ0KKwkJcXVldWVfZmxhZ19jbGVhcl91bmxvY2tl
ZChRVUVVRV9GTEFHX0RJU0NBUkQsIG1kZGV2LT5xdWV1ZSk7DQorDQogCS8q
IG5lZWQgdG8gY2hlY2sgdGhhdCBldmVyeSBibG9jayBoYXMgYXQgbGVhc3Qg
b25lIHdvcmtpbmcgbWlycm9yICovDQogCWlmICghZW5vdWdoKGNvbmYsIC0x
KSkgew0KIAkJcHJpbnRrKEtFUk5fRVJSICJtZC9yYWlkMTA6JXM6IG5vdCBl
bm91Z2ggb3BlcmF0aW9uYWwgbWlycm9ycy5cbiIsDQpkaWZmIC11IC0tcmVj
dXJzaXZlIC0tbmV3LWZpbGUgbGludXgtMy41Lm9yaWcvZHJpdmVycy9tZC9y
YWlkMS5jIGxpbnV4LTMuNS9kcml2ZXJzL21kL3JhaWQxLmMNCi0tLSBsaW51
eC0zLjUub3JpZy9kcml2ZXJzL21kL3JhaWQxLmMJMjAxMi0wNy0yMSAyMDo1
ODoyOS4wMDAwMDAwMDAgKzAwMDANCisrKyBsaW51eC0zLjUvZHJpdmVycy9t
ZC9yYWlkMS5jCTIwMTItMDctMjcgMDY6NTM6MzkuNTA3MTIxNDM1ICswMDAw
DQpAQCAtNzA3LDcgKzcwNywxMiBAQA0KIAkJd2hpbGUgKGJpbykgeyAvKiBz
dWJtaXQgcGVuZGluZyB3cml0ZXMgKi8NCiAJCQlzdHJ1Y3QgYmlvICpuZXh0
ID0gYmlvLT5iaV9uZXh0Ow0KIAkJCWJpby0+YmlfbmV4dCA9IE5VTEw7DQot
CQkJZ2VuZXJpY19tYWtlX3JlcXVlc3QoYmlvKTsNCisJCQlpZiAodW5saWtl
bHkoKGJpby0+YmlfcncgJiBSRVFfRElTQ0FSRCkgJiYNCisJCQkgICAgIWJs
a19xdWV1ZV9kaXNjYXJkKGJkZXZfZ2V0X3F1ZXVlKGJpby0+YmlfYmRldikp
KSkNCisJCQkJLyogSnVzdCBpZ25vcmUgaXQgKi8NCisJCQkJYmlvX2VuZGlv
KGJpbywgMCk7DQorCQkJZWxzZQ0KKwkJCQlnZW5lcmljX21ha2VfcmVxdWVz
dChiaW8pOw0KIAkJCWJpbyA9IG5leHQ7DQogCQl9DQogCX0gZWxzZQ0KQEAg
LTg4Miw2ICs4ODcsNyBAQA0KIAljb25zdCBpbnQgcncgPSBiaW9fZGF0YV9k
aXIoYmlvKTsNCiAJY29uc3QgdW5zaWduZWQgbG9uZyBkb19zeW5jID0gKGJp
by0+YmlfcncgJiBSRVFfU1lOQyk7DQogCWNvbnN0IHVuc2lnbmVkIGxvbmcg
ZG9fZmx1c2hfZnVhID0gKGJpby0+YmlfcncgJiAoUkVRX0ZMVVNIIHwgUkVR
X0ZVQSkpOw0KKwljb25zdCB1bnNpZ25lZCBsb25nIGRvX2Rpc2NhcmQgPSAo
YmlvLT5iaV9ydyAmIChSRVFfRElTQ0FSRCB8IFJFUV9TRUNVUkUpKTsNCiAJ
c3RydWN0IG1kX3JkZXYgKmJsb2NrZWRfcmRldjsNCiAJaW50IGZpcnN0X2Ns
b25lOw0KIAlpbnQgc2VjdG9yc19oYW5kbGVkOw0KQEAgLTExODEsNyArMTE4
Nyw3IEBADQogCQkJCSAgIGNvbmYtPm1pcnJvcnNbaV0ucmRldi0+ZGF0YV9v
ZmZzZXQpOw0KIAkJbWJpby0+YmlfYmRldiA9IGNvbmYtPm1pcnJvcnNbaV0u
cmRldi0+YmRldjsNCiAJCW1iaW8tPmJpX2VuZF9pbwk9IHJhaWQxX2VuZF93
cml0ZV9yZXF1ZXN0Ow0KLQkJbWJpby0+YmlfcncgPSBXUklURSB8IGRvX2Zs
dXNoX2Z1YSB8IGRvX3N5bmM7DQorCQltYmlvLT5iaV9ydyA9IFdSSVRFIHwg
ZG9fZmx1c2hfZnVhIHwgZG9fc3luYyB8IGRvX2Rpc2NhcmQ7DQogCQltYmlv
LT5iaV9wcml2YXRlID0gcjFfYmlvOw0KIA0KIAkJYXRvbWljX2luYygmcjFf
YmlvLT5yZW1haW5pbmcpOw0KQEAgLTE0MjQsNiArMTQzMCw4IEBADQogCQlj
bGVhcl9iaXQoVW5tZXJnZWQsICZyZGV2LT5mbGFncyk7DQogCX0NCiAJbWRf
aW50ZWdyaXR5X2FkZF9yZGV2KHJkZXYsIG1kZGV2KTsNCisJaWYgKGJsa19x
dWV1ZV9kaXNjYXJkKGJkZXZfZ2V0X3F1ZXVlKHJkZXYtPmJkZXYpKSkNCisJ
CXF1ZXVlX2ZsYWdfc2V0X3VubG9ja2VkKFFVRVVFX0ZMQUdfRElTQ0FSRCwg
bWRkZXYtPnF1ZXVlKTsNCiAJcHJpbnRfY29uZihjb25mKTsNCiAJcmV0dXJu
IGVycjsNCiB9DQpAQCAtMjY1NCw2ICsyNjYyLDcgQEANCiAJaW50IGk7DQog
CXN0cnVjdCBtZF9yZGV2ICpyZGV2Ow0KIAlpbnQgcmV0Ow0KKwlib29sIGRp
c2NhcmRfc3VwcG9ydGVkID0gZmFsc2U7DQogDQogCWlmIChtZGRldi0+bGV2
ZWwgIT0gMSkgew0KIAkJcHJpbnRrKEtFUk5fRVJSICJtZC9yYWlkMTolczog
cmFpZCBsZXZlbCBub3Qgc2V0IHRvIG1pcnJvcmluZyAoJWQpXG4iLA0KQEAg
LTI2ODMsOCArMjY5MiwxNiBAQA0KIAkJCWNvbnRpbnVlOw0KIAkJZGlza19z
dGFja19saW1pdHMobWRkZXYtPmdlbmRpc2ssIHJkZXYtPmJkZXYsDQogCQkJ
CSAgcmRldi0+ZGF0YV9vZmZzZXQgPDwgOSk7DQorDQorCQlpZiAoYmxrX3F1
ZXVlX2Rpc2NhcmQoYmRldl9nZXRfcXVldWUocmRldi0+YmRldikpKQ0KKwkJ
CWRpc2NhcmRfc3VwcG9ydGVkID0gdHJ1ZTsNCiAJfQ0KIA0KKwlpZiAoZGlz
Y2FyZF9zdXBwb3J0ZWQpDQorCQlxdWV1ZV9mbGFnX3NldF91bmxvY2tlZChR
VUVVRV9GTEFHX0RJU0NBUkQsIG1kZGV2LT5xdWV1ZSk7DQorCWVsc2UNCisJ
CXF1ZXVlX2ZsYWdfY2xlYXJfdW5sb2NrZWQoUVVFVUVfRkxBR19ESVNDQVJE
LCBtZGRldi0+cXVldWUpOw0KKw0KIAltZGRldi0+ZGVncmFkZWQgPSAwOw0K
IAlmb3IgKGk9MDsgaSA8IGNvbmYtPnJhaWRfZGlza3M7IGkrKykNCiAJCWlm
IChjb25mLT5taXJyb3JzW2ldLnJkZXYgPT0gTlVMTCB8fA0KZGlmZiAtdSAt
LXJlY3Vyc2l2ZSAtLW5ldy1maWxlIGxpbnV4LTMuNS5vcmlnL2ZzL2Jpby5j
IGxpbnV4LTMuNS9mcy9iaW8uYw0KLS0tIGxpbnV4LTMuNS5vcmlnL2ZzL2Jp
by5jCTIwMTItMDctMjEgMjA6NTg6MjkuMDAwMDAwMDAwICswMDAwDQorKysg
bGludXgtMy41L2ZzL2Jpby5jCTIwMTItMDctMjcgMDY6NTM6MzkuNTA3MTIx
NDM1ICswMDAwDQpAQCAtMTUwMCw3ICsxNTAwLDcgQEANCiAJdHJhY2VfYmxv
Y2tfc3BsaXQoYmRldl9nZXRfcXVldWUoYmktPmJpX2JkZXYpLCBiaSwNCiAJ
CQkJYmktPmJpX3NlY3RvciArIGZpcnN0X3NlY3RvcnMpOw0KIA0KLQlCVUdf
T04oYmktPmJpX3ZjbnQgIT0gMSk7DQorCUJVR19PTihiaS0+YmlfdmNudCAh
PSAxICYmIGJpLT5iaV92Y250ICE9IDApOw0KIAlCVUdfT04oYmktPmJpX2lk
eCAhPSAwKTsNCiAJYXRvbWljX3NldCgmYnAtPmNudCwgMyk7DQogCWJwLT5l
cnJvciA9IDA7DQpAQCAtMTUxMCwxNyArMTUxMCwxOSBAQA0KIAlicC0+Ymlv
Mi5iaV9zaXplIC09IGZpcnN0X3NlY3RvcnMgPDwgOTsNCiAJYnAtPmJpbzEu
Ymlfc2l6ZSA9IGZpcnN0X3NlY3RvcnMgPDwgOTsNCiANCi0JYnAtPmJ2MSA9
IGJpLT5iaV9pb192ZWNbMF07DQotCWJwLT5idjIgPSBiaS0+YmlfaW9fdmVj
WzBdOw0KLQlicC0+YnYyLmJ2X29mZnNldCArPSBmaXJzdF9zZWN0b3JzIDw8
IDk7DQotCWJwLT5idjIuYnZfbGVuIC09IGZpcnN0X3NlY3RvcnMgPDwgOTsN
Ci0JYnAtPmJ2MS5idl9sZW4gPSBmaXJzdF9zZWN0b3JzIDw8IDk7DQorCWlm
IChiaS0+YmlfdmNudCAhPSAwKSB7DQorCQlicC0+YnYxID0gYmktPmJpX2lv
X3ZlY1swXTsNCisJCWJwLT5idjIgPSBiaS0+YmlfaW9fdmVjWzBdOw0KKwkJ
YnAtPmJ2Mi5idl9vZmZzZXQgKz0gZmlyc3Rfc2VjdG9ycyA8PCA5Ow0KKwkJ
YnAtPmJ2Mi5idl9sZW4gLT0gZmlyc3Rfc2VjdG9ycyA8PCA5Ow0KKwkJYnAt
PmJ2MS5idl9sZW4gPSBmaXJzdF9zZWN0b3JzIDw8IDk7DQogDQotCWJwLT5i
aW8xLmJpX2lvX3ZlYyA9ICZicC0+YnYxOw0KLQlicC0+YmlvMi5iaV9pb192
ZWMgPSAmYnAtPmJ2MjsNCisJCWJwLT5iaW8xLmJpX2lvX3ZlYyA9ICZicC0+
YnYxOw0KKwkJYnAtPmJpbzIuYmlfaW9fdmVjID0gJmJwLT5idjI7DQogDQot
CWJwLT5iaW8xLmJpX21heF92ZWNzID0gMTsNCi0JYnAtPmJpbzIuYmlfbWF4
X3ZlY3MgPSAxOw0KKwkJYnAtPmJpbzEuYmlfbWF4X3ZlY3MgPSAxOw0KKwkJ
YnAtPmJpbzIuYmlfbWF4X3ZlY3MgPSAxOw0KKwl9DQogDQogCWJwLT5iaW8x
LmJpX2VuZF9pbyA9IGJpb19wYWlyX2VuZF8xOw0KIAlicC0+YmlvMi5iaV9l
bmRfaW8gPSBiaW9fcGFpcl9lbmRfMjsNCmRpZmYgLXUgLS1yZWN1cnNpdmUg
LS1uZXctZmlsZSBsaW51eC0zLjUub3JpZy9pbmNsdWRlL2xpbnV4L2Jsa2Rl
di5oIGxpbnV4LTMuNS9pbmNsdWRlL2xpbnV4L2Jsa2Rldi5oDQotLS0gbGlu
dXgtMy41Lm9yaWcvaW5jbHVkZS9saW51eC9ibGtkZXYuaAkyMDEyLTA3LTIx
IDIwOjU4OjI5LjAwMDAwMDAwMCArMDAwMA0KKysrIGxpbnV4LTMuNS9pbmNs
dWRlL2xpbnV4L2Jsa2Rldi5oCTIwMTItMDctMjcgMDY6NTM6MzkuNTA3MTIx
NDM1ICswMDAwDQpAQCAtNTkwLDcgKzU5MCw3IEBADQogICogaXQgYWxyZWFk
eSBiZSBzdGFydGVkIGJ5IGRyaXZlci4NCiAgKi8NCiAjZGVmaW5lIFJRX05P
TUVSR0VfRkxBR1MJXA0KLQkoUkVRX05PTUVSR0UgfCBSRVFfU1RBUlRFRCB8
IFJFUV9TT0ZUQkFSUklFUiB8IFJFUV9GTFVTSCB8IFJFUV9GVUEpDQorCShS
RVFfTk9NRVJHRSB8IFJFUV9TVEFSVEVEIHwgUkVRX1NPRlRCQVJSSUVSIHwg
UkVRX0ZMVVNIIHwgUkVRX0ZVQSB8IFJFUV9ESVNDQVJEKQ0KICNkZWZpbmUg
cnFfbWVyZ2VhYmxlKHJxKQlcDQogCSghKChycSktPmNtZF9mbGFncyAmIFJR
X05PTUVSR0VfRkxBR1MpICYmIFwNCiAJICgoKHJxKS0+Y21kX2ZsYWdzICYg
UkVRX0RJU0NBUkQpIHx8IFwNCg==

--8323328-1418712126-1344431451=:30954--
