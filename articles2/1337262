Path: news.gmane.org!not-for-mail
From: Takashi Iwai <tiwai@suse.de>
Newsgroups: gmane.linux.alsa.devel,gmane.linux.kernel
Subject: Re: Move snd_legacy_find_free_ioport to initval.h
Date: Fri, 03 Aug 2012 15:13:14 +0200
Lines: 113
Approved: news@gmane.org
Message-ID: <s5htxwkm845.wl%tiwai@suse.de>
References: <201208011605.39519.linux@rainbow-software.org>
NNTP-Posting-Host: plane.gmane.org
Mime-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset="us-ascii"
Content-Transfer-Encoding: 7bit
X-Trace: dough.gmane.org 1343999601 10263 80.91.229.3 (3 Aug 2012 13:13:21 GMT)
X-Complaints-To: usenet@dough.gmane.org
NNTP-Posting-Date: Fri, 3 Aug 2012 13:13:21 +0000 (UTC)
Cc: alsa-devel@alsa-project.org,
 Kernel development list <linux-kernel@vger.kernel.org>
To: Ondrej Zary <linux@rainbow-software.org>
Original-X-From: alsa-devel-bounces@alsa-project.org Fri Aug 03 15:13:21 2012
Return-path: <alsa-devel-bounces@alsa-project.org>
Envelope-to: glad-alsa-devel-2@m.gmane.org
Original-Received: from alsa0.perex.cz ([77.48.224.243])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <alsa-devel-bounces@alsa-project.org>)
	id 1SxHgt-0005cv-1C
	for glad-alsa-devel-2@m.gmane.org; Fri, 03 Aug 2012 15:13:19 +0200
Original-Received: by alsa0.perex.cz (Postfix, from userid 1000)
	id EE9DC26609C; Fri,  3 Aug 2012 15:13:14 +0200 (CEST)
X-Spam-Checker-Version: SpamAssassin 3.2.4 (2008-01-01) on mail1.perex.cz
X-Spam-Level: 
X-Spam-Status: No, score=-7.0 required=5.0 tests=RCVD_IN_DNSWL_HI,SPF_FAIL
	autolearn=disabled version=3.2.4
Original-Received: from alsa0.perex.cz (localhost [IPv6:::1])
	by alsa0.perex.cz (Postfix) with ESMTP id 1F95A266095;
	Fri,  3 Aug 2012 15:13:14 +0200 (CEST)
X-Original-To: alsa-devel@alsa-project.org
Delivered-To: alsa-devel@alsa-project.org
Original-Received: by alsa0.perex.cz (Postfix, from userid 1000)
 id 5FACB266096; Fri,  3 Aug 2012 15:13:13 +0200 (CEST)
Original-Received: from mx2.suse.de (cantor2.suse.de [195.135.220.15])
 by alsa0.perex.cz (Postfix) with ESMTP id 99750266094
 for <alsa-devel@alsa-project.org>; Fri,  3 Aug 2012 15:13:12 +0200 (CEST)
Original-Received: from relay2.suse.de (unknown [195.135.220.254])
 (using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
 (No client certificate requested)
 by mx2.suse.de (Postfix) with ESMTP id B2034A2111;
 Fri,  3 Aug 2012 15:13:14 +0200 (CEST)
In-Reply-To: <201208011605.39519.linux@rainbow-software.org>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/24.1
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
X-BeenThere: alsa-devel@alsa-project.org
X-Mailman-Version: 2.1.14
Precedence: list
List-Id: "Alsa-devel mailing list for ALSA developers -
 http://www.alsa-project.org" <alsa-devel.alsa-project.org>
List-Unsubscribe: <http://mailman.alsa-project.org/mailman/options/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=unsubscribe>
List-Archive: <http://mailman.alsa-project.org/pipermail/alsa-devel/>
List-Post: <mailto:alsa-devel@alsa-project.org>
List-Help: <mailto:alsa-devel-request@alsa-project.org?subject=help>
List-Subscribe: <http://mailman.alsa-project.org/mailman/listinfo/alsa-devel>, 
 <mailto:alsa-devel-request@alsa-project.org?subject=subscribe>
Errors-To: alsa-devel-bounces@alsa-project.org
Original-Sender: alsa-devel-bounces@alsa-project.org
Xref: news.gmane.org gmane.linux.alsa.devel:99621 gmane.linux.kernel:1337262
Archived-At: <http://permalink.gmane.org/gmane.linux.kernel/1337262>

At Wed, 1 Aug 2012 16:05:39 +0200,
Ondrej Zary wrote:
> 
> Move snd_legacy_find_free_ioport() function back to initval.h as it is used
> by two drivers.
> 
> Signed-off-by: Ondrej Zary <linux@rainbow-software.org>

Applied now (for 3.7).  Thanks.


Takashi

> 
> diff --git a/include/sound/initval.h b/include/sound/initval.h
> index f99a0d2..ac62c67 100644
> --- a/include/sound/initval.h
> +++ b/include/sound/initval.h
> @@ -50,6 +50,20 @@
>  #define SNDRV_DEFAULT_DMA_SIZE	{ [0 ... (SNDRV_CARDS-1)] = SNDRV_AUTO_DMA_SIZE }
>  #define SNDRV_DEFAULT_PTR	SNDRV_DEFAULT_STR
>  
> +#ifdef SNDRV_LEGACY_FIND_FREE_IOPORT
> +static long snd_legacy_find_free_ioport(long *port_table, long size)
> +{
> +	while (*port_table != -1) {
> +		if (request_region(*port_table, size, "ALSA test")) {
> +			release_region(*port_table, size);
> +			return *port_table;
> +		}
> +		port_table++;
> +	}
> +	return -1;
> +}
> +#endif
> +
>  #ifdef SNDRV_LEGACY_FIND_FREE_IRQ
>  #include <linux/interrupt.h>
>  
> diff --git a/sound/isa/opti9xx/miro.c b/sound/isa/opti9xx/miro.c
> index c24594c..3d1afb6 100644
> --- a/sound/isa/opti9xx/miro.c
> +++ b/sound/isa/opti9xx/miro.c
> @@ -37,6 +37,7 @@
>  #include <sound/opl4.h>
>  #include <sound/control.h>
>  #include <sound/info.h>
> +#define SNDRV_LEGACY_FIND_FREE_IOPORT
>  #define SNDRV_LEGACY_FIND_FREE_IRQ
>  #define SNDRV_LEGACY_FIND_FREE_DMA
>  #include <sound/initval.h>
> @@ -770,20 +771,6 @@ static int __devinit snd_miro_mixer(struct snd_card *card,
>  	return 0;
>  }
>  
> -static long snd_legacy_find_free_ioport(long *port_table, long size)
> -{
> -	while (*port_table != -1) {
> -		struct resource *res;
> -		if ((res = request_region(*port_table, size, 
> -					  "ALSA test")) != NULL) {
> -			release_and_free_resource(res);
> -			return *port_table;
> -		}
> -		port_table++;
> -	}
> -	return -1;
> -}
> -
>  static int __devinit snd_miro_init(struct snd_miro *chip,
>  				   unsigned short hardware)
>  {
> diff --git a/sound/isa/opti9xx/opti92x-ad1848.c b/sound/isa/opti9xx/opti92x-ad1848.c
> index f8fbe22..2899c9f 100644
> --- a/sound/isa/opti9xx/opti92x-ad1848.c
> +++ b/sound/isa/opti9xx/opti92x-ad1848.c
> @@ -39,6 +39,7 @@
>  #ifndef OPTi93X
>  #include <sound/opl4.h>
>  #endif
> +#define SNDRV_LEGACY_FIND_FREE_IOPORT
>  #define SNDRV_LEGACY_FIND_FREE_IRQ
>  #define SNDRV_LEGACY_FIND_FREE_DMA
>  #include <sound/initval.h>
> @@ -185,19 +186,6 @@ static char * snd_opti9xx_names[] = {
>  	"82C930",	"82C931",	"82C933"
>  };
>  
> -
> -static long __devinit snd_legacy_find_free_ioport(long *port_table, long size)
> -{
> -	while (*port_table != -1) {
> -		if (request_region(*port_table, size, "ALSA test")) {
> -			release_region(*port_table, size);
> -			return *port_table;
> -		}
> -		port_table++;
> -	}
> -	return -1;
> -}
> -
>  static int __devinit snd_opti9xx_init(struct snd_opti9xx *chip,
>  				      unsigned short hardware)
>  {
> 
> 
> -- 
> Ondrej Zary
> _______________________________________________
> Alsa-devel mailing list
> Alsa-devel@alsa-project.org
> http://mailman.alsa-project.org/mailman/listinfo/alsa-devel
> 
