Path: news.gmane.org!not-for-mail
From: Takashi Iwai <tiwai@suse.de>
Newsgroups: gmane.linux.kernel
Subject: Re: sound: BUG: can't load gdm greeter on battery with Linux 3.5
Date: Sun, 05 Aug 2012 14:57:27 +0200
Lines: 47
Approved: news@gmane.org
Message-ID: <s5hzk69ijig.wl%tiwai@suse.de>
References: <501E68C3.3080108@free.fr>
NNTP-Posting-Host: plane.gmane.org
Mime-Version: 1.0 (generated by SEMI 1.14.6 - "Maruoka")
Content-Type: text/plain; charset=US-ASCII
X-Trace: dough.gmane.org 1344171507 27076 80.91.229.3 (5 Aug 2012 12:58:27 GMT)
X-Complaints-To: usenet@dough.gmane.org
NNTP-Posting-Date: Sun, 5 Aug 2012 12:58:27 +0000 (UTC)
Cc: dgreid@chromium.org, perex@perex.cz, linux-kernel@vger.kernel.org
To: Vincent Blut <vincent.debian@free.fr>
Original-X-From: linux-kernel-owner@vger.kernel.org Sun Aug 05 14:58:27 2012
Return-path: <linux-kernel-owner@vger.kernel.org>
Envelope-to: glk-linux-kernel-3@plane.gmane.org
Original-Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <linux-kernel-owner@vger.kernel.org>)
	id 1Sy0Pa-00042G-DD
	for glk-linux-kernel-3@plane.gmane.org; Sun, 05 Aug 2012 14:58:26 +0200
Original-Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1754392Ab2HEM5a (ORCPT <rfc822;glk-linux-kernel-3@m.gmane.org>);
	Sun, 5 Aug 2012 08:57:30 -0400
Original-Received: from cantor2.suse.de ([195.135.220.15]:46141 "EHLO mx2.suse.de"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1753761Ab2HEM53 (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Sun, 5 Aug 2012 08:57:29 -0400
Original-Received: from relay1.suse.de (unknown [195.135.220.254])
	(using TLSv1 with cipher DHE-RSA-AES256-SHA (256/256 bits))
	(No client certificate requested)
	by mx2.suse.de (Postfix) with ESMTP id C2543A2C8B;
	Sun,  5 Aug 2012 14:57:27 +0200 (CEST)
In-Reply-To: <501E68C3.3080108@free.fr>
User-Agent: Wanderlust/2.15.9 (Almost Unreal) SEMI/1.14.6 (Maruoka)
 FLIM/1.14.9 (=?UTF-8?B?R29qxY0=?=) APEL/10.8 Emacs/24.1
 (x86_64-suse-linux-gnu) MULE/6.0 (HANACHIRUSATO)
Original-Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
Xref: news.gmane.org gmane.linux.kernel:1337823
Archived-At: <http://permalink.gmane.org/gmane.linux.kernel/1337823>

At Sun, 05 Aug 2012 14:36:19 +0200,
Vincent Blut wrote:
> 
> Hi,
> 
> Despite that the subject might suggest that this is a bug in the graphic
> stack, it appears that
> commit [b4a91cf0] makes the GDM greeter not loadable, however GDM has
> been correctly loaded:
> 
> # service gdm3 status
> [ ok ] gdm3 is running.
> 
> This issue only affects Linux 3.5 when I boot on battery, I spent some
> time to bisect and  this commit seems to be the bad one:
> 
> commit b4a91cf05c33d4ab5b2b3738a257a3fe49b462bd
> Author: Dylan Reid <dgreid@chromium.org>
> Date:   Fri Jun 15 19:36:23 2012 -0700
> 
>     ALSA: hda - Handle open while transitioning to D3.
>    
>     This addresses an issue encountered when a pcm is opened while
>     transitioning to low power state (codec->power_on == 1 &&
>     codec->power_transition == -1).  Add snd_pcm_power_up_d3wait to
>     hda_codec.  This function is used to power up from azx_open as opposed
>     to snd_hda_power_up used from codec_exec_verb. When powering up from
>     azx_open, wait for pending power downs to complete, avoiding the power
>     up continuing in parallel with the power down on the work queue.
>    
>     The specific issue seen was with the CS4210 codec, it powers off the ADC
>     and DAC nid in its suspend handler.  If it is re-opened before the
>     ~100ms power down process completes, the ADC and DAC nid are initialized
>     while powered down and audio is lost until another suspend/resume cycle.
>    
>     Signed-off-by: Dylan Reid <dgreid@chromium.org>
>     Signed-off-by: Takashi Iwai <tiwai@suse.de>
> 
> Is this a known issue?

Yes.  There is a known side-effect by this change, and the fix was
already queued for 3.5.1 stable kernel.


thanks,

Takashi
