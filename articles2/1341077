Path: news.gmane.org!not-for-mail
From: Feng Tang <feng.tang@intel.com>
Newsgroups: gmane.linux.kernel
Subject: [PATCH] wm831x-dcdc: fix coccinelle warnings of missing IRQF_ONESHOT
Date: Fri, 10 Aug 2012 08:58:24 +0800
Lines: 61
Approved: news@gmane.org
Message-ID: <1344560304-4322-1-git-send-email-feng.tang@intel.com>
NNTP-Posting-Host: plane.gmane.org
X-Trace: dough.gmane.org 1344560634 24515 80.91.229.3 (10 Aug 2012 01:03:54 GMT)
X-Complaints-To: usenet@dough.gmane.org
NNTP-Posting-Date: Fri, 10 Aug 2012 01:03:54 +0000 (UTC)
Cc: linux-kernel@vger.kernel.org,
	Fengguang Wu <fengguang.wu@intel.com>,
	Feng Tang <feng.tang@intel.com>
To: Axel Lin <axel.lin@gmail.com>, broonie@opensource.wolfsonmicro.com
Original-X-From: linux-kernel-owner@vger.kernel.org Fri Aug 10 03:03:53 2012
Return-path: <linux-kernel-owner@vger.kernel.org>
Envelope-to: glk-linux-kernel-3@plane.gmane.org
Original-Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <linux-kernel-owner@vger.kernel.org>)
	id 1Szddp-0004Id-9W
	for glk-linux-kernel-3@plane.gmane.org; Fri, 10 Aug 2012 03:03:53 +0200
Original-Received: (majordomo@vger.kernel.org) by vger.kernel.org via listexpand
	id S1756553Ab2HJBDr (ORCPT <rfc822;glk-linux-kernel-3@m.gmane.org>);
	Thu, 9 Aug 2012 21:03:47 -0400
Original-Received: from mga02.intel.com ([134.134.136.20]:14605 "EHLO mga02.intel.com"
	rhost-flags-OK-OK-OK-OK) by vger.kernel.org with ESMTP
	id S1751440Ab2HJBDq (ORCPT <rfc822;linux-kernel@vger.kernel.org>);
	Thu, 9 Aug 2012 21:03:46 -0400
Original-Received: from orsmga002.jf.intel.com ([10.7.209.21])
  by orsmga101.jf.intel.com with ESMTP; 09 Aug 2012 18:03:45 -0700
X-ExtLoop1: 1
X-IronPort-AV: E=Sophos;i="4.77,743,1336374000"; 
   d="scan'208";a="183870796"
Original-Received: from feng-i7.sh.intel.com ([10.239.14.125])
  by orsmga002.jf.intel.com with ESMTP; 09 Aug 2012 18:03:35 -0700
X-Mailer: git-send-email 1.7.1
Original-Sender: linux-kernel-owner@vger.kernel.org
Precedence: bulk
List-ID: <linux-kernel.vger.kernel.org>
X-Mailing-List: linux-kernel@vger.kernel.org
Xref: news.gmane.org gmane.linux.kernel:1341077
Archived-At: <http://permalink.gmane.org/gmane.linux.kernel/1341077>

From: Fengguang Wu <fengguang.wu@intel.com>

/c/kernel-tests/src/linux/drivers/regulator/wm831x-dcdc.c:829:7-27: ERROR: Threaded IRQ with no primary handler requested without IRQF_ONESHOT
/c/kernel-tests/src/linux/drivers/regulator/wm831x-dcdc.c:695:7-27: ERROR: Threaded IRQ with no primary handler requested without IRQF_ONESHOT
/c/kernel-tests/src/linux/drivers/regulator/wm831x-dcdc.c:533:7-27: ERROR: Threaded IRQ with no primary handler requested without IRQF_ONESHOT
/c/kernel-tests/src/linux/drivers/regulator/wm831x-dcdc.c:542:7-27: ERROR: Threaded IRQ with no primary handler requested without IRQF_ONESHOT

Generated by: scripts/coccinelle/misc/irqf_oneshot.cocci

 Make sure threaded IRQs without a primary handler are always request with
 IRQF_ONESHOT

Signed-off-by: Fengguang Wu <fengguang.wu@intel.com>
Signed-off-by: Feng Tang <feng.tang@intel.com>
---
 drivers/regulator/wm831x-dcdc.c |    8 ++++----
 1 files changed, 4 insertions(+), 4 deletions(-)

diff --git a/drivers/regulator/wm831x-dcdc.c b/drivers/regulator/wm831x-dcdc.c
index 7413885..a2a6093 100644
--- a/drivers/regulator/wm831x-dcdc.c
+++ b/drivers/regulator/wm831x-dcdc.c
@@ -532,7 +532,7 @@ static __devinit int wm831x_buckv_probe(struct platform_device *pdev)
 
 	irq = wm831x_irq(wm831x, platform_get_irq_byname(pdev, "UV"));
 	ret = request_threaded_irq(irq, NULL, wm831x_dcdc_uv_irq,
-				   IRQF_TRIGGER_RISING, dcdc->name, dcdc);
+				   IRQF_TRIGGER_RISING | IRQF_ONESHOT, dcdc->name, dcdc);
 	if (ret != 0) {
 		dev_err(&pdev->dev, "Failed to request UV IRQ %d: %d\n",
 			irq, ret);
@@ -541,7 +541,7 @@ static __devinit int wm831x_buckv_probe(struct platform_device *pdev)
 
 	irq = wm831x_irq(wm831x, platform_get_irq_byname(pdev, "HC"));
 	ret = request_threaded_irq(irq, NULL, wm831x_dcdc_oc_irq,
-				   IRQF_TRIGGER_RISING, dcdc->name, dcdc);
+				   IRQF_TRIGGER_RISING | IRQF_ONESHOT, dcdc->name, dcdc);
 	if (ret != 0) {
 		dev_err(&pdev->dev, "Failed to request HC IRQ %d: %d\n",
 			irq, ret);
@@ -694,7 +694,7 @@ static __devinit int wm831x_buckp_probe(struct platform_device *pdev)
 
 	irq = wm831x_irq(wm831x, platform_get_irq_byname(pdev, "UV"));
 	ret = request_threaded_irq(irq, NULL, wm831x_dcdc_uv_irq,
-				   IRQF_TRIGGER_RISING,	dcdc->name, dcdc);
+				   IRQF_TRIGGER_RISING | IRQF_ONESHOT,	dcdc->name, dcdc);
 	if (ret != 0) {
 		dev_err(&pdev->dev, "Failed to request UV IRQ %d: %d\n",
 			irq, ret);
@@ -828,7 +828,7 @@ static __devinit int wm831x_boostp_probe(struct platform_device *pdev)
 
 	irq = wm831x_irq(wm831x, platform_get_irq_byname(pdev, "UV"));
 	ret = request_threaded_irq(irq, NULL, wm831x_dcdc_uv_irq,
-				   IRQF_TRIGGER_RISING, dcdc->name,
+				   IRQF_TRIGGER_RISING | IRQF_ONESHOT, dcdc->name,
 				   dcdc);
 	if (ret != 0) {
 		dev_err(&pdev->dev, "Failed to request UV IRQ %d: %d\n",
-- 
1.7.1

