Path: news.gmane.org!not-for-mail
From: Thierry Reding <thierry.reding-RM9K5IK7kjKj5M59NBduVrNAH6kLmebB@public.gmane.org>
Newsgroups: gmane.linux.ports.tegra,gmane.linux.kernel,gmane.linux.drivers.devicetree
Subject: Re: [RFC][PATCH v3 1/3] runtime interpreted power sequences
Date: Thu, 2 Aug 2012 10:21:57 +0200
Lines: 82
Approved: news@gmane.org
Message-ID: <20120802082157.GA14866@avionic-0098.adnet.avionic-design.de>
References: <1343390750-3642-1-git-send-email-acourbot@nvidia.com>
 <1343390750-3642-2-git-send-email-acourbot@nvidia.com>
 <50170EA0.1010408@wwwdotorg.org>
 <501A338D.7080105@nvidia.com>
NNTP-Posting-Host: plane.gmane.org
Mime-Version: 1.0
Content-Type: multipart/signed; micalg=pgp-sha1;
	protocol="application/pgp-signature"; boundary="OgqxwSJOaUobr8KG"
X-Trace: dough.gmane.org 1343895741 28250 80.91.229.3 (2 Aug 2012 08:22:21 GMT)
X-Complaints-To: usenet@dough.gmane.org
NNTP-Posting-Date: Thu, 2 Aug 2012 08:22:21 +0000 (UTC)
Cc: Stephen Warren <swarren-3lzwWm7+Weoh9ZMKESR00Q@public.gmane.org>,
	Stephen Warren <swarren-DDmLM1+adcrQT0dZR+AlfA@public.gmane.org>,
	Simon Glass <sjg-F7+t8E8rja9g9hUCZPvPmw@public.gmane.org>,
	Grant Likely <grant.likely-s3s/WqlpOiPyB63q8FvJNQ@public.gmane.org>,
	Rob Herring <rob.herring-bsGFqQB8/DxBDgjK7y7TUQ@public.gmane.org>,
	Greg Kroah-Hartman <gregkh-hQyY1W1yCW8ekmWlsbkhG0B+6BGkLq7r@public.gmane.org>,
	Mark Brown <broonie-yzvPICuk2AATkU/dhu1WVueM+bqZidxxQQ4Iyu8u01E@public.gmane.org>,
	Arnd Bergmann <arnd-r2nGTMty4D4@public.gmane.org>,
	"linux-tegra-u79uwXL29TY76Z2rM5mHXA@public.gmane.org" <linux-tegra-u79uwXL29TY76Z2rM5mHXA@public.gmane.org>,
	"linux-kernel-u79uwXL29TY76Z2rM5mHXA@public.gmane.org" <linux-kernel-u79uwXL29TY76Z2rM5mHXA@public.gmane.org>,
	"linux-fbdev-u79uwXL29TY76Z2rM5mHXA@public.gmane.org" <linux-fbdev-u79uwXL29TY76Z2rM5mHXA@public.gmane.org>,
	"devicetree-discuss-uLR06cmDAlY/bJ5BZ2RsiQ@public.gmane.org" 
	<devicetree-discuss-uLR06cmDAlY/bJ5BZ2RsiQ@public.gmane.org>
To: Alex Courbot <acourbot-DDmLM1+adcrQT0dZR+AlfA@public.gmane.org>
Original-X-From: linux-tegra-owner-u79uwXL29TY76Z2rM5mHXA@public.gmane.org Thu Aug 02 10:22:17 2012
Return-path: <linux-tegra-owner-u79uwXL29TY76Z2rM5mHXA@public.gmane.org>
Envelope-to: glpt-linux-tegra-wOFGN7rlS/M9smdsby/KFg@public.gmane.org
Original-Received: from vger.kernel.org ([209.132.180.67])
	by plane.gmane.org with esmtp (Exim 4.69)
	(envelope-from <linux-tegra-owner-u79uwXL29TY76Z2rM5mHXA@public.gmane.org>)
	id 1Swqfc-00016f-0a
	for glpt-linux-tegra-wOFGN7rlS/M9smdsby/KFg@public.gmane.org; Thu, 02 Aug 2012 10:22:12 +0200
Original-Received: (majordomo-u79uwXL29TY76Z2rM5mHXA@public.gmane.org) by vger.kernel.org via listexpand
	id S1751179Ab2HBIWL (ORCPT <rfc822;glpt-linux-tegra@m.gmane.org>);
	Thu, 2 Aug 2012 04:22:11 -0400
Original-Received: from moutng.kundenserver.de ([212.227.17.8]:63917 "EHLO
	moutng.kundenserver.de" rhost-flags-OK-OK-OK-OK) by vger.kernel.org
	with ESMTP id S1751133Ab2HBIWH (ORCPT
	<rfc822;linux-tegra-u79uwXL29TY76Z2rM5mHXA@public.gmane.org>); Thu, 2 Aug 2012 04:22:07 -0400
Original-Received: from mailbox.adnet.avionic-design.de (mailbox.avionic-design.de [109.75.18.3])
	by mrelayeu.kundenserver.de (node=mrbap1) with ESMTP (Nemesis)
	id 0M03sS-1TmkMe1p8O-00ugmg; Thu, 02 Aug 2012 10:22:01 +0200
Original-Received: from localhost (localhost [127.0.0.1])
	by mailbox.adnet.avionic-design.de (Postfix) with ESMTP id C19922A282DE;
	Thu,  2 Aug 2012 10:21:59 +0200 (CEST)
X-Virus-Scanned: amavisd-new at avionic-design.de
Original-Received: from mailbox.adnet.avionic-design.de ([127.0.0.1])
	by localhost (mailbox.avionic-design.de [127.0.0.1]) (amavisd-new, port 10024)
	with ESMTP id x0VH50WMwnAT; Thu,  2 Aug 2012 10:21:58 +0200 (CEST)
Original-Received: from localhost (avionic-0098.adnet.avionic-design.de [172.20.31.233])
	(Authenticated sender: thierry.reding)
	by mailbox.adnet.avionic-design.de (Postfix) with ESMTPA id 79B7F2A28203;
	Thu,  2 Aug 2012 10:21:58 +0200 (CEST)
Content-Disposition: inline
In-Reply-To: <501A338D.7080105-DDmLM1+adcrQT0dZR+AlfA@public.gmane.org>
User-Agent: Mutt/1.5.21 (2010-09-15)
X-Provags-ID: V02:K0:XQ3fRF6vX0d2UrZIUgtrzq1XrgYa5J1aolf5HCoN2W7
 Gpuqmm6elIo/KFfvDmmUAx45DbYVvaMfQ2mUhVc1HRQlGIX/+w
 EuOmajc0vRGAxIA7Nek9BTjOnPORyeCj9Cqd9Jg87Dy77wY/Wg
 /QOx8K44OXD3Rl4RV6j8bAfQzYSWDP7W/7Xlvf8UTqWv/MWkWn
 EJdC7xGwQ4Y/lfad5AK45sTfXgV7jZsE69AsmDWi+4DPSrPItw
 3hEyg6PVXMrBTIarf3mfdCwaQ1rgsEoXNa8ygooly0QeOx9/hR
 TW6E6VIR0vholrUS7y1KcHkjgFZCkRWWJerC5NEg8RGUaIW0AJ
 xUnnf0TejB0U0eT4diJldsGty30moFegLN5N9ugd7eK3wUak/V
 eLCeCGJ1Pb4fQxRZ4vTvGIu+QWLf0bMv9z1YwqX0C84ATrRIkm
 IcIHa
Original-Sender: linux-tegra-owner-u79uwXL29TY76Z2rM5mHXA@public.gmane.org
Precedence: bulk
List-ID: <linux-tegra.vger.kernel.org>
X-Mailing-List: linux-tegra-u79uwXL29TY76Z2rM5mHXA@public.gmane.org
Xref: news.gmane.org gmane.linux.ports.tegra:5730 gmane.linux.kernel:1336733 gmane.linux.drivers.devicetree:18915
Archived-At: <http://permalink.gmane.org/gmane.linux.kernel/1336733>


--OgqxwSJOaUobr8KG
Content-Type: text/plain; charset=us-ascii
Content-Disposition: inline
Content-Transfer-Encoding: quoted-printable

On Thu, Aug 02, 2012 at 05:00:13PM +0900, Alex Courbot wrote:
> On 07/31/2012 07:45 AM, Stephen Warren wrote:
> >Oh I see. That's a little confusing. Why not just reference the relevant
> >resources directly in each step; something more like:
> >
> >		gpio@1 {
> >			action =3D "enable-gpio";
> >			gpio =3D <&gpio 1 0>;
> >		};
> >
> >I guess that might make parsing/building a little harder, since you'd
> >have to detect when you'd already done gpio_request() on a given GPIO
> >and not repeat it or something like that, but to me this makes the DT a
> >lot easier to comprehend.
>=20
> I tried to move towards having the phandles directly in the
> sequences themselves - that reminded me why I did not do that in the
> first place. Let's say we have a sequence like this (reg property
> omitted on purpose):
>=20
> 	power-on-sequence {
> 		step@0 {
> 			regulator =3D <&backlight_reg>;
> 			enable;
> 		};
> 		step@1 {
> 			delay =3D <10000>;
> 		};
> 		step@2 {
> 			pwm =3D <&pwm 2 5000000>;
> 			enable;
> 		};
> 		step@3 {
> 			gpio =3D <&gpio 28 0>;
> 			enable;
> 		};
> 	};
>=20
> The problem is, how do we turn these phandles into the resource of
> interest. The type of the resource can be infered by the name of the
> property. The hard part is resolving the resource from the phandle -
> it seems like the API just does not allow to do this. GPIO has
> of_get_named_gpio, but AFAIK there are no equivalent for regulator
> consumer and PWM: the only way to use the DT with them is through
> get_regulator and get_pwm which work at the device level.
>=20
> Or is there a way that I overlooked?

No, you are right. Perhaps we should add exported functions that do the
equivalent of of_pwm_request() or the regulator_dev_lookup() and
of_get_regulator() pair.

Thierry

--OgqxwSJOaUobr8KG
Content-Type: application/pgp-signature

-----BEGIN PGP SIGNATURE-----
Version: GnuPG v2.0.19 (GNU/Linux)

iQIcBAEBAgAGBQJQGjilAAoJEN0jrNd/PrOhWQIP/ia8nbamFqB7B7+uXDeV7vqy
GRrn/b9KIIWdIIij79MoJKaoljC2Cwf+i5gviN5IrbN/wvLlZtPXLbO6du3u+YF6
4+b48S8oEysitxKCw3/9t1GGRZVbcLuC2ulHr+GOAsH42J5tD/X8NsSOPBMiL6Zm
jqNP56WcuDAyAG1maCu3cBX66rp8K3ErfOb6QveFmzAWZKGajvQY+/bkdp+bQRPX
gAe7SOqVp1n9u4Tj8gqJC6UQyp+hDulDEZ4yQx/fyRJbxuy1i0gu+33FWhFSVolQ
+aHDIhSZdClv9AnCp2HM8FrXh4BWTh2h31wu+P3h+IV2D0OzQ45SJ/uptMPkwhoT
CjeGIsDxfOI7yriCUxZ65zHnhdlPRJP9FSF+5qknRthgxP4LCidEcdMidPU5lLQa
ditQPl8iiuMq3gDr/GTkOQpiSThAP6GOqhdRVWz8wJgnxKibKMMNvV8mgz+kfMSW
N+N38Lj/njak7rIqkdrDilxrtpqFJq3kqOY97O0wVGdelpx8lT8Qu7NoOIsanDdh
IL1UO5pXgCX1QzS/M++hNnx6riRjIUood1cYyzyd8J/qOY9Sl9MT+9gOMcwfRevh
oaR18VD5uPrSxtYufrvO/tXFB90hucHfosEnDuKP3uB45tUhddgRsUi1iKIjr7MO
yEb1u6FLcbdCIbqD49rQ
=HfNb
-----END PGP SIGNATURE-----

--OgqxwSJOaUobr8KG--
